<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Kent Johnson" />

<meta name="date" content="2017-07-12" />

<title>Computing Inter-cellular Distances</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Computing Inter-cellular Distances</h1>
<h4 class="author"><em>Kent Johnson</em></h4>
<h4 class="date"><em>2017-07-12</em></h4>


<div id="TOC">
<ul>
<li><a href="#nearest-neighbor-distances">Nearest neighbor distances</a><ul>
<li><a href="#computing-with-find_nearest_distance">Computing with <code>find_nearest_distance</code></a></li>
<li><a href="#analyzing-nearest-neighbor-distances">Analyzing nearest neighbor distances</a></li>
</ul></li>
<li><a href="#cells-within-a-radius">Cells within a radius</a><ul>
<li><a href="#computing-with-count_within">Computing with <code>count_within</code></a></li>
<li><a href="#count-multiple-files-or-phenotypes-using-count_within_batch">Count multiple files or phenotypes using <code>count_within_batch</code></a></li>
</ul></li>
<li><a href="#visualizing-nearest-neighbors">Visualizing nearest neighbors</a></li>
</ul>
</div>

<style type="text/css">
img { 
  border: none;
}
table {
    width: auto !important;
}
</style>
<p><code>informr</code> contains several functions which analyze and report on the spatial relationship between cells in a single field.</p>
<div id="nearest-neighbor-distances" class="section level2">
<h2>Nearest neighbor distances</h2>
<div id="computing-with-find_nearest_distance" class="section level3">
<h3>Computing with <code>find_nearest_distance</code></h3>
<p>The <code>find_nearest_distance</code> function finds per-cell nearest neighbor distances. For each cell and each phenotype in a sample, it finds the nearest neighbor of that phenotype. The distances are returned in a <code>data_frame</code> with one column per phenotype.</p>
<p>For example, the <code>informr</code> sample data <code>sample_cell_seg_data</code> contains 6 unique phenotypes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(informr)

csd =<span class="st"> </span>sample_cell_seg_data
csd %&gt;%<span class="st"> </span><span class="kw">count</span>(Phenotype)</code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">Phenotype</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">T reg Foxp3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">cytotoxic CD8</td>
<td align="right">293</td>
</tr>
<tr class="odd">
<td align="left">helper CD4</td>
<td align="right">59</td>
</tr>
<tr class="even">
<td align="left">macrophage CD68</td>
<td align="right">359</td>
</tr>
<tr class="odd">
<td align="left">other</td>
<td align="right">1710</td>
</tr>
<tr class="even">
<td align="left">tumor</td>
<td align="right">3303</td>
</tr>
</tbody>
</table>
</div>
<p>This file contains only two FoxP3+ cells, and the ‘other’ cells are not of interest, so first filter them out.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">csd =<span class="st"> </span>csd %&gt;%<span class="st"> </span><span class="kw">filter</span>(!Phenotype %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">'T reg Foxp3'</span>, <span class="st">'other'</span>))</code></pre></div>
<p>Calling <code>find_nearest_distance</code> on this file returns a <code>data_frame</code> with four columns and one row for each cell:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distances =<span class="st"> </span><span class="kw">find_nearest_distance</span>(csd)
<span class="kw">glimpse</span>(distances)</code></pre></div>
<pre><code>Observations: 4,014
Variables: 4
$ Distance to cytotoxic CD8   &lt;dbl&gt; 15.231546, 21.505813, 14.008926, 1...
$ Distance to helper CD4      &lt;dbl&gt; 140.12584, 136.88042, 137.29530, 1...
$ Distance to macrophage CD68 &lt;dbl&gt; 11.597414, 28.160256, 9.552487, 24...
$ Distance to tumor           &lt;dbl&gt; 3.201562, 9.552487, 3.201562, 13.7...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nrow</span>(csd)</code></pre></div>
<pre><code>[1] 4014</code></pre>
<p>To create a combined data frame, use <code>dplyr::bind_cols</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">csd_with_distance =<span class="st"> </span><span class="kw">bind_cols</span>(csd, distances)</code></pre></div>
<p>Note: Cell positions in a cell seg data file are relative to the top-left corner of the field, so calling <code>find_nearest_distance</code> on a merged data file will fail. One way to add distance columns to a merged data file is to use <code>dplyr::group_by</code> to process each field separately. For example, if <code>merged</code> contains merged cell seg data, add distance columns with this code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">merged_with_distance =<span class="st"> </span>merged %&gt;%
<span class="st">  </span>dplyr::<span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Sample Name</span><span class="st">`</span>) %&gt;%
<span class="st">  </span>dplyr::<span class="kw">do</span>(dplyr::<span class="kw">bind_cols</span>(., <span class="kw">find_nearest_distance</span>(.)))</code></pre></div>
</div>
<div id="analyzing-nearest-neighbor-distances" class="section level3">
<h3>Analyzing nearest neighbor distances</h3>
<p>Once the nearest neighbors have been computed per cell, standard aggregation, analysis and plotting commands can be used to examine the results. For example, find the mean nearest neighbor distances by phenotype:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">csd_with_distance %&gt;%<span class="st"> </span><span class="kw">group_by</span>(Phenotype) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">'Distance to'</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarize_all</span>(~<span class="kw">round</span>(<span class="kw">mean</span>(.), <span class="dv">1</span>))</code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="left">Phenotype</th>
<th align="right">Distance to cytotoxic CD8</th>
<th align="right">Distance to helper CD4</th>
<th align="right">Distance to macrophage CD68</th>
<th align="right">Distance to tumor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">cytotoxic CD8</td>
<td align="right">21.4</td>
<td align="right">75.0</td>
<td align="right">24.7</td>
<td align="right">16.7</td>
</tr>
<tr class="even">
<td align="left">helper CD4</td>
<td align="right">24.8</td>
<td align="right">34.8</td>
<td align="right">25.5</td>
<td align="right">21.0</td>
</tr>
<tr class="odd">
<td align="left">macrophage CD68</td>
<td align="right">31.6</td>
<td align="right">70.2</td>
<td align="right">18.9</td>
<td align="right">21.8</td>
</tr>
<tr class="even">
<td align="left">tumor</td>
<td align="right">38.1</td>
<td align="right">91.8</td>
<td align="right">35.0</td>
<td align="right">7.8</td>
</tr>
</tbody>
</table>
</div>
<p>Show the distribution of distances in a density plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(csd_with_distance, <span class="kw">aes</span>(<span class="st">`</span><span class="dt">Distance to helper CD4</span><span class="st">`</span>, <span class="dt">color=</span>Phenotype)) +
<span class="st">  </span><span class="kw">geom_density</span>()</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
</div>
<div id="cells-within-a-radius" class="section level2">
<h2>Cells within a radius</h2>
<div id="computing-with-count_within" class="section level3">
<h3>Computing with <code>count_within</code></h3>
<p>The <code>count_within</code> function looks at the number of cells within a radius of another cell and returns summary measures. For example, use <code>count_within</code> to find the number of macrophages having a tumor cell within 25 microns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count_within</span>(csd, <span class="dt">from=</span><span class="st">'macrophage CD68'</span>, <span class="dt">to=</span><span class="st">'tumor'</span>, <span class="dt">radius=</span><span class="dv">25</span>)</code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">radius</th>
<th align="right">from_count</th>
<th align="right">to_count</th>
<th align="right">from_with</th>
<th align="right">within_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">25</td>
<td align="right">359</td>
<td align="right">3303</td>
<td align="right">257</td>
<td align="right">5.183844</td>
</tr>
</tbody>
</table>
</div>
<p>In this result, <code>from_count</code> and <code>to_count</code> are the total numbers of eligible cells. They agree with the counts in the first table in this vignette. <code>from_with</code> is the number of <code>macrophage CD68</code> cells having at least one <code>tumor</code> cell within 25 μm. <code>within_mean</code> is the average number of <code>tumor</code> cells found within 25 μm of each <code>macrophage CD68</code> cell.</p>
<p>Note there are some subtleties to <code>count_within</code>. Most importantly, it is not symmetric. In this example, the number of <code>tumor</code> cells with a <code>macrophage CD68</code> within 25 microns is not the same as the number of <code>macrophage CD68</code> cells with a <code>tumor</code> cell within 25 microns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count_within</span>(csd, <span class="dt">from=</span><span class="st">'tumor'</span>, <span class="dt">to=</span><span class="st">'macrophage CD68'</span>, <span class="dt">radius=</span><span class="dv">25</span>)</code></pre></div>
<div class="kable-table">
<table>
<thead>
<tr class="header">
<th align="right">radius</th>
<th align="right">from_count</th>
<th align="right">to_count</th>
<th align="right">from_with</th>
<th align="right">within_mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">25</td>
<td align="right">3303</td>
<td align="right">359</td>
<td align="right">1195</td>
<td align="right">0.5634272</td>
</tr>
</tbody>
</table>
</div>
<p>Please see <code>help(count_within)</code> for details.</p>
</div>
<div id="count-multiple-files-or-phenotypes-using-count_within_batch" class="section level3">
<h3>Count multiple files or phenotypes using <code>count_within_batch</code></h3>
<p>You may want to run <code>count_within</code> on an entire directory of cell seg data files, or to count multiple combinations of phenotypes. Both of these are possible using <code>count_within_batch</code>. Instead of a <code>data_frame</code>, you pass it the path to a directory containing multiple cell seg data files. The <code>from</code>, <code>to</code>, and <code>category</code> parameters are lists and may contain multiple entries.</p>
<p>For example, the following commands will count <code>T Reg</code> cells with a <code>Cytotoxic T Cell</code> or <code>PDL1+ Tumor Cell</code> within 10 or 25 μm, with separate counts for each <code>to</code> phenotype and for <code>tumor</code> and <code>stroma</code> tissue categories. Counts will be calculated for all <code>cell_seg_data.txt</code> files in <code>my_directory</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">base_path =<span class="st"> &quot;/path/to/my_directory&quot;</span>

from =<span class="st"> </span><span class="kw">list</span>(<span class="st">'T Reg'</span>)
to =<span class="st"> </span><span class="kw">list</span>(<span class="st">'Cytotoxic T Cell'</span>, <span class="st">'PDL1+ Tumor Cell'</span>)
radii =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">25</span>)
categories =<span class="st"> </span><span class="kw">c</span>(<span class="st">'stroma'</span>, <span class="st">'tumor'</span>)

<span class="kw">count_within_batch</span>(base_path, from, to, radii, categories)</code></pre></div>
<p>See <code>help(count_within_batch)</code> for additional details.</p>
</div>
</div>
<div id="visualizing-nearest-neighbors" class="section level2">
<h2>Visualizing nearest neighbors</h2>
<p>The <code>spatial_distribution_report</code> function is a bit different from the other functions mentioned in this vignette. Rather than calculate and return distance metrics, it creates a report which shows visually the nearest neighbor relations between two phenotypes in a single field. Because the result is a stand-alone HTML file, it can’t easily be demonstrated in a vignette. For an example, copy and paste this code into your own copy of R. It will create a sample report in your user directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cell_seg_path =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;TMA&quot;</span>,
                       <span class="st">&quot;Core[1,5,6,1]_[21302,15107]_cell_seg_data.txt&quot;</span>,
                       <span class="dt">package =</span> <span class="st">&quot;informr&quot;</span>)

phenotypes =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;macrophage CD68&quot;</span>, <span class="st">&quot;cytotoxic CD8&quot;</span>)
colors =<span class="st"> </span><span class="kw">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>)
out_path =<span class="st"> </span><span class="kw">path.expand</span>(<span class="st">'~/spatial_distribution_report.html'</span>)

<span class="kw">spatial_distribution_report</span>(cell_seg_path, phenotypes, colors, out_path)</code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
