<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find and count touching cells for pairs of phenotypes. — count_touching_cells • phenoptr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Find and count touching cells for pairs of phenotypes. — count_touching_cells" />
<meta property="og:description" content="count_touching_cells uses morphological analysis of nuclear and
membrane segmentation maps to find touching cells of paired phenotypes.
It reports the number of touching cells found and, optionally,
writes image files showing the touching cells." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phenoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/reading_tables.html">Reading and exploring inForm tables</a>
    </li>
    <li>
      <a href="../articles/computing_distances.html">Computing inter-cellular distances</a>
    </li>
    <li>
      <a href="../articles/find_and_count_touching_cells.html">Find and count touching cells</a>
    </li>
    <li>
      <a href="../articles/reading_image_files.html">Reading and displaying inForm image Files</a>
    </li>
    <li>
      <a href="../articles/selecting_cells.html">Selecting cells within a cell segmentation table</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="https://github.com/akoyabio/phenoptr">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find and count touching cells for pairs of phenotypes.</h1>
    <small class="dont-index">Source: <a href='https://github.com/akoyabio/phenoptr/blob/master/R/count_touching_cells.R'><code>R/count_touching_cells.R</code></a></small>
    <div class="hidden name"><code>count_touching_cells.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>count_touching_cells</code> uses morphological analysis of nuclear and
membrane segmentation maps to find touching cells of paired phenotypes.
It reports the number of touching cells found and, optionally,
writes image files showing the touching cells.</p>
    </div>

    <pre class="usage"><span class='fu'>count_touching_cells</span>(
  <span class='no'>cell_seg_path</span>,
  <span class='no'>pairs</span>,
  <span class='kw'>colors</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>phenotype_rules</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>categories</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>write_images</span> <span class='kw'>=</span> !<span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span>(<span class='no'>colors</span>),
  <span class='kw'>output_base</span> <span class='kw'>=</span> <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cell_seg_path</th>
      <td><p>The path to the cell seg data file. The same directory
must also contain <code>_memb_seg_map.tif</code> or <code>_binary_seg_maps.tif</code> and, if
<code>write_images</code> is true, a  TIFF or JPEG composite image from inForm.</p></td>
    </tr>
    <tr>
      <th>pairs</th>
      <td><p>A list of pairs of phenotypes. Each entry is a two-element
vector. The result will contain one line for each pair showing the
number of cells and number of touches. Pairs must match two different
sets of cells; in particular, touches of a phenotype to itself are
not supported.</p></td>
    </tr>
    <tr>
      <th>colors</th>
      <td><p>A named list of phenotype colors to use when drawing
the output. Only used when <code>write_images</code> is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>phenotype_rules</th>
      <td><p>(Optional) A named list.
Item names are phenotype names and must match entries in <code>pairs</code>.
Item values are selectors for <a href='select_rows.html'>select_rows</a>.</p></td>
    </tr>
    <tr>
      <th>categories</th>
      <td><p>If given, a vector or list of tissue category names.
Categories not in the list will be excluded from the analysis.</p></td>
    </tr>
    <tr>
      <th>write_images</th>
      <td><p>If <code>TRUE</code>, for each pair, write an image showing the
touching pairs. Requires <code>colors</code> and a composite image in the same
directory as the cell seg table.</p></td>
    </tr>
    <tr>
      <th>output_base</th>
      <td><p>Base path for image output.
If <code>NULL</code>, output will be to the same
directory as the cell table.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a <code>tibble</code> with one row for each pair in
<code>pairs</code>, containing these columns:</p><dl'>
<dt><code>slide_id</code></dt><dd><p>Slide ID from the data file, if available.</p></dd>
<dt><code>source</code></dt><dd><p>Base file name of the source file with
<code>_cell_seg_data.txt</code> stripped off for brevity.</p></dd>
<dt><code>phenotype1</code></dt><dd><p>The name of the first phenotype in
the touching pair.</p></dd>
<dt><code>phenotype2</code></dt><dd><p>The name of the second phenotype in
the touching pair.</p></dd>
<dt><code>total1</code></dt><dd><p>The total number of <code>phenotype1</code> cells
in the image.</p></dd>
<dt><code>total2</code></dt><dd><p>The total number of <code>phenotype2</code> cells
in the image.</p></dd>
<dt><code>p1_touch_p2</code></dt><dd><p>The number of <code>phenotype1</code> cells
touching a <code>phenotype2</code> cell.</p></dd>
<dt><code>p2_touch_p1</code></dt><dd><p>The number of <code>phenotype2</code> cells
touching a <code>phenotype1</code> cell.</p></dd>
<dt><code>touch_mutual</code></dt><dd><p>The number of mutually touching pairs.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function requires a cell seg data file and a matching
segmentation map file. If <code>write_images</code> is true,
a composite image is required.
If the cell seg data uses micron units, a composite data file is also
required.</p>
<p>Cells are considered to touch if they have any amount of common membrane
as determined by the inForm membrane segmentation. Cells which meet only
at a corner, like black squares on a checkerboard, are not counted as
touching.</p>
<p>The number of touching cells is reported in three ways. For a pair of
phenotypes A and B, this function reports the number of A touching a B,
the number of B touching an A, and the number of mutually touching pairs.
Note that the number of mutual touches is often larger than the count of
either "A touching B" or "B touching A" because a single touching cell
may be part of multiple pairs.</p>
<p>The image files written show cells of the selected phenotypes on a background
of the composite. Touching cells are filled in the provided color;
cells which are not touching the other phenotype are outlined.
Image files are written as
TIFF files to preserve the fine detail of cell boundaries.</p>
<p>Images are only written when both phenotypes of the pair are represented.</p>
<p>See the tutorial
<a href='https://akoyabio.github.io/phenoptr/articles/selecting_cells.html'>Selecting cells within a cell segmentation table</a>
for more on
the use of <code>pairs</code> and <code>phenotype_rules</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other distance functions: 
<code><a href='compute_all_nearest_distance.html'>compute_all_nearest_distance</a>()</code>,
<code><a href='count_within_batch.html'>count_within_batch</a>()</code>,
<code><a href='count_within_many.html'>count_within_many</a>()</code>,
<code><a href='count_within.html'>count_within</a>()</code>,
<code><a href='distance_matrix.html'>distance_matrix</a>()</code>,
<code><a href='find_nearest_distance.html'>find_nearest_distance</a>()</code>,
<code><a href='spatial_distribution_report.html'>spatial_distribution_report</a>()</code>,
<code><a href='subset_distance_matrix.html'>subset_distance_matrix</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># This example creates an image in a subdirectory of the</span>
<span class='co'># current user's directory.</span>
<span class='no'>cell_seg_path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sample_cell_seg_data.html'>sample_cell_seg_path</a></span>()

<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"CD68+"</span>, <span class='st'>"CD8+"</span>))
<span class='no'>colors</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"CD68+"</span><span class='kw'>=</span><span class='st'>'magenta'</span>, <span class='st'>"CD8+"</span><span class='kw'>=</span><span class='st'>'yellow'</span>)
<span class='no'>output_base</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/path.expand.html'>path.expand</a></span>(<span class='st'>'~/touches'</span>)

<span class='fu'>count_touching_cells</span>(<span class='no'>cell_seg_path</span>, <span class='no'>pairs</span>, <span class='no'>colors</span>,
  <span class='kw'>output_base</span><span class='kw'>=</span><span class='no'>output_base</span>)

<span class='co'># This example will count and image all files in the `base_path` directory.</span>
<span class='no'>base_path</span> <span class='kw'>&lt;-</span> <span class='st'>'/path/to/data'</span>
<span class='no'>output_base</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>base_path</span>, <span class='st'>'touches'</span>)
<span class='no'>files</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='list_cell_seg_files.html'>list_cell_seg_files</a></span>(<span class='no'>base_path</span>)

<span class='co'># The phenotype pairs to locate. This will find CD8 cells touching</span>
<span class='co'># tumor cells, and, separately, CD8 cells touching CD68 cells.</span>
<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"CD8+"</span>, <span class='st'>"CK+"</span>),
             <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"CD8+"</span>, <span class='st'>"CD68+"</span>))

<span class='co'># Colors for all the phenotypes mentioned in pairs</span>
<span class='no'>colors</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='st'>'CD8+'</span> <span class='kw'>=</span> <span class='st'>'yellow'</span>,
  <span class='st'>'CK+'</span> <span class='kw'>=</span> <span class='st'>'cyan'</span>,
  <span class='st'>'CD68+'</span> <span class='kw'>=</span> <span class='st'>'magenta'</span>
)

<span class='co'># Count and visualize touching cells</span>
<span class='no'>touch_counts</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>purrr</span><span class='kw ns'>::</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map_df</a></span>(<span class='no'>files</span>, <span class='kw'>function</span>(<span class='no'>path</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='st'>'Processing'</span>, <span class='no'>path</span>, <span class='st'>'\n'</span>)
  <span class='fu'>count_touching_cells</span>(<span class='no'>path</span>, <span class='no'>pairs</span>, <span class='no'>colors</span>, <span class='kw'>output_base</span><span class='kw'>=</span><span class='no'>output_base</span>)
})

<span class='co'># Save the result</span>
<span class='no'>touches_path</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>output_base</span>, <span class='st'>'TouchCounts.csv'</span>)
<span class='kw pkg'>readr</span><span class='kw ns'>::</span><span class='fu'><a href='https://readr.tidyverse.org/reference/write_delim.html'>write_csv</a></span>(<span class='no'>touch_counts</span>, <span class='no'>touches_path</span>)

<span class='co'># The phenotype definitions can be more complex. The default is to use</span>
<span class='co'># the names in `pairs`. Using `phenotype_rules`, the definition can be</span>
<span class='co'># anything allowed by select_rows().</span>

<span class='co'># You can also limit the tissue category.</span>

<span class='co'># For example, find all touches between lymphocytes and tumor cells</span>
<span class='co'># within the tumor:</span>
<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'Tumor'</span>, <span class='st'>'Lymphocyte'</span>))
<span class='no'>colors</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>Tumor</span><span class='kw'>=</span><span class='st'>'cyan'</span>, <span class='kw'>Lymphocyte</span><span class='kw'>=</span><span class='st'>'yellow'</span>)
<span class='no'>phenotype_rules</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
  <span class='kw'>Lymphocyte</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'CD8+'</span>, <span class='st'>'FoxP3+'</span>)
)

<span class='no'>touch_counts</span> <span class='kw'>&lt;-</span> <span class='fu'>map_df</span>(<span class='no'>files</span>, <span class='kw'>function</span>(<span class='no'>path</span>) {
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='st'>'Processing'</span>, <span class='no'>path</span>, <span class='st'>'\n'</span>)
  <span class='fu'>count_touching_cells</span>(<span class='no'>path</span>, <span class='no'>pairs</span>, <span class='no'>colors</span>, <span class='no'>phenotype_rules</span>,
                       <span class='kw'>categories</span><span class='kw'>=</span><span class='st'>'tumor'</span>,
                       <span class='kw'>output_base</span><span class='kw'>=</span><span class='no'>output_base</span>)
})

<span class='co'># Then write the results as above.</span>
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kent S Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


