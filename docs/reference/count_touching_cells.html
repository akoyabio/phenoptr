<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find and count touching cells for pairs of phenotypes. — count_touching_cells â€¢ phenoptr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">phenoptr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/computing_distances.html">Computing Inter-cellular Distances</a>
    </li>
    <li>
      <a href="../articles/reading_image_files.html">Reading and Displaying inForm Image Files</a>
    </li>
    <li>
      <a href="../articles/selecting_cells.html">Selecting cells within a cell segmentation table</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PerkinElmer/phenoptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find and count touching cells for pairs of phenotypes.</h1>
    </div>

    
    <p><code>count_touching_cells</code> uses morphological analysis of nuclear and
membrane segmentation maps to find touching cells of paired phenotypes.
It reports the number of touching cells found and, optionally,
writes image files showing the touching cells.</p>
    

    <pre class="usage"><span class='fu'>count_touching_cells</span>(<span class='no'>cell_seg_path</span>, <span class='no'>pairs</span>, <span class='kw'>phenotype_rules</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>categories</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>colors</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>mutual</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>write_images</span> <span class='kw'>=</span> !<span class='fu'>is.null</span>(<span class='no'>colors</span>), <span class='kw'>output_base</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cell_seg_path</th>
      <td><p>The path to the cell seg data file. The same directory
must also contain <code>_memb_seg_map.tif</code> or <code>_binary_seg_maps.tif</code> and, if
<code>write_images</code> is true, a  TIFF or JPEG composite image.</p></td>
    </tr>
    <tr>
      <th>pairs</th>
      <td><p>A list of pairs of phenotypes. Each entry is a two-element
vector. The result will contain one or two lines for each pair showing the
number of cells and number of touches.</p></td>
    </tr>
    <tr>
      <th>phenotype_rules</th>
      <td><p>A named list. The item names are the phenotype
names and must include all the names in <code>pairs</code>.
The values are selectors for <a href='select_rows.html'>select_rows</a>.
If <code>phenotype_rules</code> is <code>NULL</code>, the names in <code>pairs</code> are used directly as
the phenotypes.</p></td>
    </tr>
    <tr>
      <th>categories</th>
      <td><p>If given, a vector or list of tissue category names.
Categories not in the list will be excluded from the analysis.</p></td>
    </tr>
    <tr>
      <th>colors</th>
      <td><p>A named list of phenotype colors to use when drawing
the output. Only used when <code>write_images</code> is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>mutual</th>
      <td><p>If <code>TRUE</code>, returns stats on mutually touching pairs,
rather than separate counts of cells for each phenotype.</p></td>
    </tr>
    <tr>
      <th>write_images</th>
      <td><p>If <code>TRUE</code>, for each pair, write an image showing the
touching pairs. Requires <code>colors</code> and a composite image in the same
directory as the cell seg table.</p></td>
    </tr>
    <tr>
      <th>output_base</th>
      <td><p>Base path for image output.
If <code>NULL</code>, output will be to the same
directory as the cell table.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <strong><code>mutual</code> is <code>TRUE</code></strong>, returns a <code>data_frame</code> with one row per
<code>pair</code>, containing these columns:</p><dl class='dl-horizontal'>
<dt><code>source</code></dt><dd><p>Base file name of the source file with
<code>_cell_seg_data.txt</code> stripped off for brevity.</p></dd>
<dt><code>phenotype1</code></dt><dd><p>The first phenotype in the touching pair.</p></dd>
<dt><code>phenotype2</code></dt><dd><p>The second phenotype in the touching pair.</p></dd>
<dt><code>count</code></dt><dd><p>The number of touching pairs.</p></dd>
<dt><code>total1</code></dt><dd><p>The total number of <code>phenotype1</code> cells
in the image.</p></dd>
<dt><code>total2</code></dt><dd><p>The total number of <code>phenotype2</code> cells
in the image.</p></dd>
</dl>

<p>If <strong><code>mutual</code> is <code>FALSE</code></strong>, returns a <code>data_frame</code> with two rows per <code>pair</code>,
containing these columns:</p><dl class='dl-horizontal'>
<dt><code>source</code></dt><dd><p>Base file name of the source file with
<code>_cell_seg_data.txt</code> stripped off for brevity.</p></dd>
<dt><code>phenotype</code></dt><dd><p>The phenotype of cells being counted.</p></dd>
<dt><code>touching</code></dt><dd><p>The phenotype of cells being touched.</p></dd>
<dt><code>count</code></dt><dd><p>The number of <code>phenotype</code> cells touching a <code>touching</code>
cell.</p></dd>
<dt><code>fraction</code></dt><dd><p>The fraction of <code>phenotype</code> cells touching a
<code>touching</code> cell.</p></dd>
<dt><code>total</code></dt><dd><p>The total number of <code>phenotype</code> cells in the image.</p></dd>
</dl>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The image files written show cells of the selected phenotypes on a background
of the composite. Touching cells are filled in the provided color;
cells which are not touching the other phenotype are outlined.
Image files are written as
TIFF files to preserve the fine detail of cell boundaries.</p>
<p>Images are only written when both phenotypes of the pair are represented.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># This example will count and image all files in the `base_path` directory.</span>
<span class='no'>base_path</span> <span class='kw'>=</span> <span class='st'>'/path/to/data'</span>
<span class='no'>out_path</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>base_path</span>, <span class='st'>'touches'</span>)
<span class='no'>files</span> <span class='kw'>=</span> <span class='fu'><a href='list_cell_seg_files.html'>list_cell_seg_files</a></span>(<span class='no'>base_path</span>)

<span class='co'># The phenotype pairs to locate. This will find CD8 cells touching</span>
<span class='co'># tumor cells, and, separately, CD8 cells touching CD68 cells.</span>
<span class='no'>pairs</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>c</span>(<span class='st'>"CD8"</span>, <span class='st'>"Tumor"</span>),
             <span class='fu'>c</span>(<span class='st'>"CD8"</span>, <span class='st'>"CD68"</span>))

<span class='co'># Colors for all the phenotypes mentioned in pairs</span>
<span class='no'>colors</span> <span class='kw'>=</span> <span class='fu'>list</span>(
  <span class='kw'>CD8</span> <span class='kw'>=</span> <span class='st'>'yellow'</span>,
  <span class='kw'>Tumor</span> <span class='kw'>=</span> <span class='st'>'cyan'</span>,
  <span class='kw'>CD68</span> <span class='kw'>=</span> <span class='st'>'pink'</span>
)

<span class='co'># Count and visualize touching cells</span>
<span class='no'>r</span> <span class='kw'>=</span> <span class='kw pkg'>purrr</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/purrr/topics/map'>map_df</a></span>(<span class='no'>files</span>, <span class='kw'>function</span>(<span class='no'>path</span>) {
  <span class='fu'>cat</span>(<span class='st'>'Processing'</span>, <span class='no'>path</span>, <span class='st'>'\n'</span>)
  <span class='fu'>count_touching_cells</span>(<span class='no'>path</span>, <span class='no'>pairs</span>, <span class='kw'>colors</span><span class='kw'>=</span><span class='no'>colors</span>, <span class='kw'>output_base</span><span class='kw'>=</span><span class='no'>output_base</span>)
})

<span class='co'># Save the result</span>
<span class='no'>outPath</span> <span class='kw'>=</span> <span class='fu'>file.path</span>(<span class='no'>output_base</span>, <span class='st'>'TouchCounts.csv'</span>)
<span class='fu'>write.csv</span>(<span class='no'>r</span>, <span class='no'>outPath</span>, <span class='kw'>row.names</span><span class='kw'>=</span><span class='fl'>FALSE</span>)

<span class='co'># The phenotype definitions can be more complex. The default is to use</span>
<span class='co'># the names in `pairs`. Using `phenotype_rules`, the definition can be</span>
<span class='co'># anything allowed by select_rows().</span>

<span class='co'># You can also limit the tissue category, and count mutual touches (pairs)</span>
<span class='co'># instead of individual touching cells.</span>

<span class='co'># For example, find all mutual touches between lymphocytes and tumor cells</span>
<span class='co'># within the tumor:</span>
<span class='no'>pairs</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='fu'>c</span>(<span class='st'>'Tumor'</span>, <span class='st'>'Lymphocyte'</span>))
<span class='no'>colors</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>Tumor</span><span class='kw'>=</span><span class='st'>'cyan'</span>, <span class='kw'>Lymphocyte</span><span class='kw'>=</span><span class='st'>'yellow'</span>)
<span class='no'>phenotype_rules</span> <span class='kw'>=</span> <span class='fu'>list</span>(
  <span class='kw'>Tumor</span><span class='kw'>=</span><span class='st'>'Tumor'</span>,
  <span class='kw'>Lymphocyte</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='st'>'CD4'</span>, <span class='st'>'CD8'</span>, <span class='st'>'TReg'</span>)
)

<span class='no'>r</span> <span class='kw'>=</span> <span class='fu'>map_df</span>(<span class='no'>full_paths</span>, <span class='kw'>function</span>(<span class='no'>path</span>) {
  <span class='fu'>cat</span>(<span class='st'>'Processing'</span>, <span class='no'>path</span>, <span class='st'>'\n'</span>)
  <span class='fu'>count_touching_cells</span>(<span class='no'>path</span>, <span class='no'>pairs</span>, <span class='no'>phenotype_rules</span>,
                       <span class='kw'>categories</span><span class='kw'>=</span><span class='st'>'tumor'</span>, <span class='kw'>colors</span><span class='kw'>=</span><span class='no'>colors</span>, <span class='kw'>mutual</span><span class='kw'>=</span><span class='fl'>TRUE</span>,
                       <span class='kw'>output_base</span><span class='kw'>=</span><span class='no'>output_base</span>)
})

<span class='co'># Then write the results as above.</span>
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Kent Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
