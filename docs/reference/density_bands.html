<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate cell density in bands from a tissue boundary. — density_bands • phenoptr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate cell density in bands from a tissue boundary. — density_bands" />
<meta property="og:description" content="Given a cell seg table and an image containing masks for two tissue
classes, estimate the density of cells of each specified
phenotype in bands from the boundary between the two
tissue classes." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phenoptr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/reading_tables.html">Reading and exploring inForm tables</a>
    </li>
    <li>
      <a href="../articles/computing_distances.html">Computing inter-cellular distances</a>
    </li>
    <li>
      <a href="../articles/find_and_count_touching_cells.html">Find and count touching cells</a>
    </li>
    <li>
      <a href="../articles/reading_image_files.html">Reading and displaying inForm image Files</a>
    </li>
    <li>
      <a href="../articles/selecting_cells.html">Selecting cells within a cell segmentation table</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="https://github.com/akoyabio/phenoptr">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate cell density in bands from a tissue boundary.</h1>
    <small class="dont-index">Source: <a href='https://github.com/akoyabio/phenoptr/blob/master/R/density_bands.R'><code>R/density_bands.R</code></a></small>
    <div class="hidden name"><code>density_bands.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a cell seg table and an image containing masks for two tissue
classes, estimate the density of cells of each specified
phenotype in bands from the boundary between the two
tissue classes.</p>
    </div>

    <pre class="usage"><span class='fu'>density_bands</span>(
  <span class='kw'>cell_seg_path</span>,
  <span class='kw'>phenotypes</span>,
  <span class='kw'>positive</span>,
  <span class='kw'>negative</span>,
  width = <span class='fl'>25</span>,
  map_path = <span class='kw'>NULL</span>,
  component_path = <span class='kw'>NULL</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>cell_seg_path</th>
      <td><p>Path to a cell segmentation data file.</p></td>
    </tr>
    <tr>
      <th>phenotypes</th>
      <td><p>Optional named list of phenotypes to process.
<code><a href='https://rdrr.io/r/base/names.html'>names(phenotypes)</a></code> are the names of the resulting phenotypes.
The values are in any format accepted by <code><a href='select_rows.html'>select_rows</a></code>.
If omitted, will use all phenotypes in the cell seg data.</p></td>
    </tr>
    <tr>
      <th>positive</th>
      <td><p>Name of the tissue category used as positive distance,
e.g. "stroma".</p></td>
    </tr>
    <tr>
      <th>negative</th>
      <td><p>Name of the tissue category used as negative distance,
e.g. "tumor".</p></td>
    </tr>
    <tr>
      <th>width</th>
      <td><p>Width of the bands, in microns</p></td>
    </tr>
    <tr>
      <th>map_path</th>
      <td><p>Path to the segmentation map file. If NULL, look for the
map in the same directory as <code>cell_seg_path</code>.</p></td>
    </tr>
    <tr>
      <th>component_path</th>
      <td><p>Path to the component_data file corresponding to
<code>cell_seg_path</code>; if omitted, look for the component data file in the
same directory as <code>cell_seg_path</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a <code>list</code> with three items:</p><dl>
<dt><code>densities</code></dt><dd><p>A <code>tibble</code> with five columns (see below).</p></dd>
<dt><code>cells</code></dt><dd><p>Cell seg data with phenotypes updated per the <code>phenotypes</code>
parameter and an additional <code>distance</code> column.</p></dd>
<dt><code>distance</code></dt><dd><p>The distance map, a pixel image
(<code><a href='https://rdrr.io/pkg/spatstat/man/im.object.html'>im.object</a></code>).</p></dd>

</dl>

<p>The <code>densities</code> item contains five columns:</p><dl>
<dt><code>phenotype</code></dt><dd><p>The supplied phenotypes.</p></dd>
<dt><code>midpoint</code></dt><dd><p>The midpoint of the distance band.</p></dd>
<dt><code>count</code></dt><dd><p>The number of cells of the phenotype found
within the band.</p></dd>
<dt><code>area</code></dt><dd><p>The area of the band, in square microns.</p></dd>
<dt><code>density</code></dt><dd><p>The density of cells of the phenotype in the band,
in cells per square micron.</p></dd>

</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>density_bands</code> uses a counting approach similar to a histogram.
First the image is divided into bands based on distance from the
specified boundary. Next, the number of cells of each phenotype
within each distance band is counted and the area of each band
is estimated. The density estimates are the ratios of the cell
counts to the area estimates.</p>
<p>Density estimates are
in cells per square micron; multiply by 1,000,000 for cells per square
millimeter.</p>
<p>The returned value includes the cell counts and area of each band,
making it straightforward to aggregate across multiple fields from a
single sample. The aggregate density is computed by summing the
cell counts and areas across all fields from a sample, then dividing
to compute density.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other density estimation: 
<code><a href='density_at_distance.html'>density_at_distance</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Compute density for the sample data</span>
<span class='kw'>values</span> <span class='op'>&lt;-</span> <span class='fu'>density_bands</span>(<span class='fu'><a href='sample_cell_seg_data.html'>sample_cell_seg_path</a></span>(),
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='st'>"CD8+"</span>, <span class='st'>"CD68+"</span>, <span class='st'>"FoxP3+"</span>),
  positive=<span class='st'>"Stroma"</span>, negative=<span class='st'>"Tumor"</span>)

<span class='co'># Plot the densities in a single plot</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'><a href='http://ggplot2.tidyverse.org'>ggplot2</a></span>)
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='kw'>values</span><span class='op'>$</span><span class='kw'>densities</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(<span class='kw'>midpoint</span>, <span class='kw'>density</span><span class='op'>*</span><span class='fl'>1000000</span>, color=<span class='kw'>phenotype</span>)) <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span>(size=<span class='fl'>2</span>) <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span>(x=<span class='st'>'Distance from tumor boundary (microns)'</span>,
       y=<span class='st'>'Estimated cell density (cells per sq mm)'</span>)
</div><div class='img'><img src='density_bands-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Kent S Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


